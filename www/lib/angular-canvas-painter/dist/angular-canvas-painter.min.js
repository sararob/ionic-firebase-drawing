"use strict";!function(t){angular.module("pw.canvas-painter",[]),function(t){try{t=angular.module("pw.canvas-painter")}catch(e){t=angular.module("pw.canvas-painter",[])}t.run(["$templateCache",function(t){t.put("../templates/canvas.html",'<div class="pwCanvasPaint" style="position:relative"><canvas id="pwCanvasMain"></canvas><canvas id="pwCanvasTmp" style="position:absolute;top:0;left:0"></canvas></div>')}])}(),function(t){try{t=angular.module("pw.canvas-painter")}catch(e){t=angular.module("pw.canvas-painter",[])}t.run(["$templateCache",function(t){t.put("../templates/color-selector.html",'<ul class="pwColorSelector"><li ng-repeat="color in colorList track by $index" class="pwColor" ng-class="{\'active\': (selectedColor === color)}" ng-style="{\'background-color\':color}" ng-click="setColor(color)"></li></ul>')}])}(),angular.module("pw.canvas-painter").directive("pwCanvas",function(){return{restrict:"AE",scope:{options:"=",version:"="},templateUrl:"../templates/canvas.html",link:function(e){var o=!!("ontouchstart"in t),n=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1,a=o?"touchstart":"mousedown",i=o?"touchmove":"mousemove",l=o?"touchend":"mouseup",r=e.options;if(r.width=r.width||400,r.height=r.height||300,r.backgroundColor=r.backgroundColor||"#fff",r.color=r.color||"#000",r.undoEnabled=r.undoEnabled||!1,r.opacity=r.opacity||.9,r.lineWidth=r.lineWidth||1,r.undo=r.undo||!1,r.imageSrc=r.imageSrc||!1,r.imageSrc){var c=new Image;c.onload=function(){h.drawImage(this,0,0)},c.src=r.imageSrc}if(r.undo){var s=[];e.$watch(function(){return s.length},function(t){e.version=t}),e.$watch("version",function(t){return 0>t?(e.version=0,void 0):t>=s.length?(e.version=s.length,void 0):(C(t),void 0)})}var u=document.getElementById("pwCanvasMain"),d=document.getElementById("pwCanvasTmp"),h=u.getContext("2d"),p=d.getContext("2d"),v={x:0,y:0},f=[];u.width=d.width=r.width,u.height=d.height=r.height,h.fillStyle=r.backgroundColor,h.fillRect(0,0,u.width,u.height),p.globalAlpha=r.opacity,p.lineJoin=p.lineCap="round",p.lineWidth=10,p.strokeStyle=r.color,e.$watch("options.lineWidth",function(t){"string"==typeof t&&(t=parseInt(t,10)),t&&"number"==typeof t&&(p.lineWidth=r.lineWidth=t)}),e.$watch("options.color",function(t){t&&(p.strokeStyle=p.fillStyle=t)}),e.$watch("options.opacity",function(t){t&&(p.globalAlpha=t)});var g=function(t,e){o?n?(t.x=e.layerX,t.y=e.layerY):(t.x=e.changedTouches[0].clientX-e.target.offsetParent.offsetLeft,t.y=e.changedTouches[0].clientY-e.target.offsetParent.offsetTop):(t.x=void 0!==e.offsetX?e.offsetX:e.layerX,t.y=void 0!==e.offsetY?e.offsetY:e.layerY)},m=function(t){if(t&&(t.preventDefault(),g(v,t)),f.push({x:v.x,y:v.y}),3===f.length){var e=f[0];return p.beginPath(),p.arc(e.x,e.y,p.lineWidth/2,0,2*Math.PI,!0),p.fill(),p.closePath(),void 0}p.clearRect(0,0,d.width,d.height),p.beginPath(),p.moveTo(f[0].x,f[0].y);for(var o=1;o<f.length-2;o++){var n=(f[o].x+f[o+1].x)/2,a=(f[o].y+f[o+1].y)/2;p.quadraticCurveTo(f[o].x,f[o].y,n,a)}p.quadraticCurveTo(f[o].x,f[o].y,f[o+1].x,f[o+1].y),p.stroke()},y=function(){r.undo&&e.$apply(function(){s.push(h.getImageData(0,0,d.width,d.height)),angular.isNumber(r.undo)&&r.undo>0&&(s=s.slice(-1*r.undo))}),d.removeEventListener(i,m,!1),h.drawImage(d,0,0),p.clearRect(0,0,d.width,d.height),f=[]},w=function(){d.addEventListener(a,function(t){t.preventDefault(),d.addEventListener(i,m,!1),g(v,t),f.push({x:v.x,y:v.y}),f.push({x:v.x,y:v.y}),m()},!1),d.addEventListener(l,y,!1)};w();var C=function(t){s.length>0&&(h.putImageData(s[t],0,0),s=s.slice(0,t))}}}}),angular.module("pw.canvas-painter").directive("pwColorSelector",function(){return{restrict:"AE",scope:{colorList:"=pwColorSelector",selectedColor:"=color"},templateUrl:"../templates/color-selector.html",link:function(t){t.setColor=function(e){t.selectedColor=e}}}})}(this);